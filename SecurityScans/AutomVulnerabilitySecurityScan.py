import nmap
import requests
import shodan

# Replace with your Shodan API key (sign up at https://www.shodan.io/)
# Obtain API Key by creating an account on Shodan. 
# activate the Accountaccount, Go to Settings, Overview, Scroll down to see your APY Key.
SHODAN_API_KEY = "SHODAN_API_KEY"

# Initialize scanners
nm = nmap.PortScanner()
shodan_api = shodan.Shodan(SHODAN_API_KEY)

# Function to scan a target IP or domain
def scan_target(target):
    print(f"Scanning target: {target}")

    # Run Nmap scan for open ports
    nm.scan(target, arguments="-sV --script=vuln")
    
    for host in nm.all_hosts():
        print(f"\n[+] Host: {host} ({nm[host].hostname()})")
        
        for proto in nm[host].all_protocols():
            ports = nm[host][proto].keys()
            for port in ports:
                service = nm[host][proto][port]['name']
                state = nm[host][proto][port]['state']
                print(f"    - Port {port}/{proto} ({service}): {state}")

                # If any vulnerability script ran, print the output
                if 'script' in nm[host][proto][port]:
                    print("    Possible Vulnerabilities:")
                    for script, output in nm[host][proto][port]['script'].items():
                        print(f"        - {script}: {output}")

# Function to check if the target is exposed on the internet using Shodan
def check_shodan(target):
    print(f"\nChecking {target} on Shodan...")
    try:
        result = shodan_api.host(target)
        print("[+] Found in Shodan! Possible exposure:")
        print(f"    - IP: {result['ip_str']}")
        print(f"    - Organization: {result.get('org', 'N/A')}")
        print(f"    - OS: {result.get('os', 'N/A')}")
        print("    - Open Ports:", result["ports"])
    except shodan.APIError:
        print("[-] No public data found on Shodan.")

# Run the scan and security checks
if __name__ == "__main__":
    target_ip = input("Enter target IP/Domain: ")
    scan_target(target_ip)
    check_shodan(target_ip)
